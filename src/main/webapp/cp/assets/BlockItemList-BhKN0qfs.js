import{d as ne,u as ie,r as n,ac as B,v as de,o as ce,aC as re,b as i,c as ue,e as k,f as g,w as t,i as a,I as me,aa as be,a9 as pe,k as E,j as s,as as f,ak as ve,l as C,t as V,ah as fe,g as _e,ae as ke,aE as ge,h as F,aJ as ye,E as N,aK as he,_ as Ie}from"./index-CZHPgLfa.js";import{S as we}from"./sortable.esm-BmjBFecF.js";import{a as Be}from"./config-CTDOWbwT.js";import{Q as Ce,R as Ve,S as $e,G as Se}from"./content-DMFQ0p_c.js";import{_ as De,a as Le,b as Ue,c as Ee}from"./QueryItem.vue_vue_type_script_setup_true_lang-D03SqPw9.js";import{a as Ne}from"./BlockItemForm.vue_vue_type_script_setup_true_lang-BpFOxwQP.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-DnC6Jnbr.js";import"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-C5CukWL8.js";import"./vuedraggable.umd-Bu-AzP8J.js";import"./BaseUpload-3Qd-5VQL.js";/* empty css                                                                   */const Re={class:"mb-3"},Te={class:"mt-3 app-block"},qe=ne({name:"BlockItemList",__name:"BlockItemList",setup(ze){const{t:$}=ie(),y=n({}),_=n(),R=n(),r=n([]),S=n([]),D=n(!1),h=n(!1),L=n(),M=B(()=>r.value.map(e=>e.id)),x=n(!1),I=n([]),p=n(),A=B(()=>I.value.find(e=>e.id===p.value)),G=B(()=>r.value.map(e=>e.image)),J=B(()=>r.value.map(e=>e.mobileImage)),T=n(!1),v=async()=>{D.value=!0;try{r.value=await Ce({...ye(y.value),blockId:p.value,Q_OrderBy:_.value}),x.value=Object.values(y.value).filter(e=>e!==void 0&&e!=="").length>0||_.value!==void 0,T.value=_.value!==void 0}finally{D.value=!1}},K=async()=>{I.value=await Be(),p.value=String(I.value[0].id)};let U;const H=()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");U=we.create(e,{handle:".drag-handle",animation:200,chosenClass:"sortable-chosen",onEnd:async function(o){const{oldIndex:u,newIndex:m}=o;u!==m&&(await Ve(r.value[u].id,r.value[m].id),r.value.splice(m,0,r.value.splice(u,1)[0]),N.success($("success")))}})};de(p,()=>v()),ce(async()=>{await K(),H()}),re(()=>{U!==void 0&&U.destroy()});const W=({column:e,prop:o,order:u})=>{var m;o&&u?_.value=((m=e.sortBy)!=null?m:o)+(u==="descending"?"_desc":""):_.value=void 0,v()},X=()=>v(),Y=()=>{R.value.clearSort(),he(y.value),_.value=void 0,v()},Z=()=>{L.value=void 0,h.value=!0},q=e=>{L.value=e,h.value=!0},z=async e=>{await $e(e),v(),N.success($("success"))},O=async e=>{await Se(e),v(),N.success($("success"))};return(e,o)=>{const u=i("el-tab-pane"),m=i("el-tabs"),ee=i("el-aside"),w=i("el-button"),P=i("el-popconfirm"),c=i("el-table-column"),ae=i("el-icon"),Q=i("el-image"),j=i("el-switch"),le=i("el-table"),te=i("el-main"),oe=i("el-container"),se=ue("loading");return k(),g(oe,null,{default:t(()=>[a(ee,{width:"180px",class:"pr-3"},{default:t(()=>[a(m,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),"tab-position":"left",stretch:"",class:"bg-white"},{default:t(()=>[(k(!0),me(pe,null,be(I.value,b=>(k(),g(u,{key:b.id,name:String(b.id),label:b.name},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(te,{class:"p-0"},{default:t(()=>{var b;return[E("div",Re,[a(s(De),{params:y.value,onSearch:X,onReset:Y},{default:t(()=>[a(s(Le),{label:e.$t("blockItem.title"),name:"Q_Contains_title"},null,8,["label"])]),_:1},8,["params"])]),E("div",null,[a(w,{type:"primary",disabled:!((b=A.value)!=null&&b.enabled)||s(f)("blockItem:create"),icon:s(ve),onClick:o[1]||(o[1]=()=>Z())},{default:t(()=>[C(V(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(P,{title:e.$t("confirmDelete"),onConfirm:o[2]||(o[2]=()=>O(S.value.map(l=>l.id)))},{reference:t(()=>[a(w,{disabled:S.value.length<=0||s(f)("blockItem:delete"),icon:s(fe)},{default:t(()=>[C(V(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(s(Ue),{name:"blockItem",class:"ml-2"})]),E("div",Te,[_e((k(),g(le,{id:"dataTable",ref_key:"table",ref:R,"row-key":"id",data:r.value,onSelectionChange:o[3]||(o[3]=l=>S.value=l),onRowDblclick:o[4]||(o[4]=l=>q(l.id)),onSortChange:W},{default:t(()=>[a(s(Ee),{name:"blockItem"},{default:t(()=>[a(c,{type:"selection",width:"38"}),a(c,{width:"42"},{default:t(()=>[a(ae,{class:ke(["text-lg align-middle",T.value||s(f)("blockItem:update")?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]]),disalbed:""},{default:t(()=>[a(s(ge))]),_:1},8,["class"])]),_:1}),a(c,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(c,{property:"title",label:e.$t("blockItem.title"),sortable:"custom","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(c,{property:"subtitle",label:e.$t("blockItem.subtitle"),sortable:"custom",display:"none","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(c,{property:"image",label:e.$t("blockItem.image")},{default:t(({row:l,$index:d})=>[l.image?(k(),g(Q,{key:0,src:l.image,fit:"contain","preview-src-list":G.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):F("",!0)]),_:1},8,["label"]),a(c,{property:"mobileImage",label:e.$t("blockItem.mobileImage"),display:"none"},{default:t(({row:l,$index:d})=>[l.mobileImage?(k(),g(Q,{key:0,src:l.mobileImage,fit:"contain","preview-src-list":J.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):F("",!0)]),_:1},8,["label"]),a(c,{property:"targetBlank",label:e.$t("blockItem.targetBlank"),sortable:"custom",width:"120"},{default:t(({row:l})=>[a(j,{modelValue:l.targetBlank,"onUpdate:modelValue":d=>l.targetBlank=d,disabled:s(f)("blockItem:update"),onChange:d=>z({...l,targetBlank:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(c,{property:"enabled",label:e.$t("enable"),sortable:"custom",width:"100"},{default:t(({row:l})=>[a(j,{modelValue:l.enabled,"onUpdate:modelValue":d=>l.enabled=d,disabled:s(f)("blockItem:update"),onChange:d=>z({...l,enabled:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(c,{label:e.$t("table.action")},{default:t(({row:l})=>[a(w,{type:"primary",disabled:s(f)("blockItem:update"),size:"small",link:"",onClick:()=>q(l.id)},{default:t(()=>[C(V(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(P,{title:e.$t("confirmDelete"),onConfirm:()=>O([l.id])},{reference:t(()=>[a(w,{type:"primary",disabled:s(f)("blockItem:delete"),size:"small",link:""},{default:t(()=>[C(V(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[se,D.value]])]),a(Ne,{modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=l=>h.value=l),"bean-id":L.value,"bean-ids":M.value,"block-id":p.value,onFinished:v},null,8,["modelValue","bean-id","bean-ids","block-id"])]}),_:1})]),_:1})}}}),He=Ie(qe,[["__scopeId","data-v-e260d231"]]);export{He as default};
